jQuery(document).ready(function(){function e(e){e=e.toLowerCase().trim().replace(/<.*?>/g,"").replace(/\s/g,"_").replace(/[^a-zA-Z0-9_]/g,""),jQuery(".role-slug").text(e)}function r(){var e=jQuery("#user_roles-tab-all input[data-grant-cap]:checked").length,r=jQuery("#user_roles-tab-all input[data-deny-cap]:checked").length,t=jQuery('#user_roles-tab-custom input[name="grant-new-caps[]"]:checked').length,a=jQuery('#user_roles-tab-custom input[name="deny-new-caps[]"]:checked').length;jQuery("#submitdiv .granted-count").text(e+t),jQuery("#submitdiv .denied-count").text(r+a)}function t(e){var r="grant",t="deny";jQuery(e).attr("data-deny-cap")&&(r="deny",t="grant");var a=jQuery(e).attr("data-"+r+"-cap");jQuery(e).prop("checked")?(jQuery("input[data-"+r+'-cap="'+a+'"]').not(e).prop("checked",!0),jQuery("input[data-"+t+'-cap="'+a+'"]').prop("checked",!1)):jQuery("input[data-"+r+'-cap="'+a+'"]').not(e).prop("checked",!1)}jQuery(".user_roles-delete-role-link").click(function(){return window.confirm(user_roles_i18n.ays_delete_role)}),jQuery('input[name="role_name"]').keyup(function(){jQuery('input[name="role"]').val()||e(this.value)}),jQuery('input[name="role"], .role-ok-button').hide(),jQuery(document).on("click",".role-edit-button.closed",function(){jQuery(this).removeClass("closed").addClass("open").text(user_roles_i18n.button_role_ok),jQuery('input[name="role"]').show(),jQuery('input[name="role"]').trigger("focus"),jQuery('input[name="role"]').attr("value",jQuery(".role-slug").text())}),jQuery(document).on("click",".role-edit-button.open",function(){jQuery(this).removeClass("open").addClass("closed").text(user_roles_i18n.button_role_edit),jQuery('input[name="role"]').hide();var r=jQuery('input[name="role"]').val();e(r?r:jQuery('input[name="role_name"]').val())}),jQuery('input[name="role"]').keypress(function(e){if(13===e.keyCode)return jQuery(".role-edit-button").click().trigger("focus"),e.preventDefault(),!1}),jQuery('.users_page_role-new input[name="role_name"]').val()||jQuery(".users_page_role-new #publish").prop("disabled",!0),jQuery('.users_page_role-new input[name="role_name"]').on("input",function(){jQuery(this).val()?jQuery(".users_page_role-new #publish").prop("disabled",!1):jQuery(".users_page_role-new #publish").prop("disabled",!0)});var a=wp.template("user_roles-cap-section"),n=wp.template("user_roles-cap-control");"undefined"!=typeof user_roles_sections&&"undefined"!=typeof user_roles_controls&&(_.each(user_roles_sections,function(e){jQuery(".user_roles-tab-wrap").append(a(e))}),_.each(user_roles_controls,function(e){jQuery("#user_roles-tab-"+e.section+" tbody").append(n(e))})),jQuery(".user_roles-cap-tabs .user_roles-tab-content").hide(),jQuery(".user_roles-cap-tabs .user_roles-tab-content:first-child").show(),jQuery(".user_roles-tab-nav :first-child").attr("aria-selected","true"),jQuery(".user_roles-which-tab").text(jQuery(".user_roles-tab-nav :first-child a").text()),jQuery(".user_roles-tab-nav li a").click(function(e){e.preventDefault();var r=jQuery(this).attr("href");jQuery(this).parents(".user_roles-cap-tabs").find(".user_roles-tab-content").hide(),jQuery(this).parents(".user_roles-cap-tabs").find(r).show(),jQuery(this).parents(".user_roles-cap-tabs").find(".user_roles-tab-title").attr("aria-selected","false"),jQuery(this).parent().attr("aria-selected","true"),jQuery(".user_roles-which-tab").text(jQuery(this).text())}),r(),jQuery(document).on("change",".user_roles-cap-checklist input[data-grant-cap], .user_roles-cap-checklist input[data-deny-cap]",function(){t(this),r()}),jQuery(document).on("click",".editable-role .user_roles-cap-checklist button",function(){var e=jQuery(this).closest(".user_roles-cap-checklist"),r=jQuery(e).find("input[data-grant-cap]"),t=jQuery(e).find("input[data-deny-cap]");jQuery(r).prop("checked")?(jQuery(r).prop("checked",!1),jQuery(t).prop("checked",!0).change()):jQuery(t).prop("checked")?(jQuery(r).prop("checked",!1),jQuery(t).prop("checked",!1).change()):jQuery(r).prop("checked",!0).change()}),jQuery(document).on("hover",".editable-role .user_roles-cap-checklist button",function(){jQuery(".user_roles-cap-checklist button:focus").not(this).blur()}),postboxes.add_postbox_toggles(pagenow),jQuery("#newcapdiv button.handlediv").attr("type","button"),jQuery("#user_roles-add-new-cap").prop("disabled",!0),jQuery("#user_roles-new-cap-field").on("input",function(){-1===jQuery.inArray(jQuery(this).val(),user_roles_i18n.hidden_caps)?jQuery("#user_roles-add-new-cap").prop("disabled",!1):jQuery("#user_roles-add-new-cap").prop("disabled",!0)}),jQuery("#user_roles-new-cap-field").keypress(function(e){if(13===e.keyCode)return jQuery("#user_roles-add-new-cap").click(),e.preventDefault(),!1}),jQuery("#user_roles-add-new-cap").click(function(){var e=jQuery("#user_roles-new-cap-field").val();if(e=e.trim().replace(/<.*?>/g,"").replace(/\s/g,"_").replace(/[^a-zA-Z0-9_]/g,"")){if(-1!==jQuery.inArray(jQuery(this).val(),user_roles_i18n.hidden_caps))return;jQuery('a[href="#user_roles-tab-custom"]').trigger("click"),user_roles_i18n.label_grant_cap=user_roles_i18n.label_grant_cap.replace(/%s/g,"<code>"+e+"</code>"),user_roles_i18n.label_deny_cap=user_roles_i18n.label_deny_cap.replace(/%s/g,"<code>"+e+"</code>");var r={cap:e,readonly:"",name:{grant:"grant-new-caps[]",deny:"deny-new-caps[]"},is_granted_cap:!0,is_denied_cap:!1,label:{cap:e,grant:user_roles_i18n.label_grant_cap,deny:user_roles_i18n.label_deny_cap}};jQuery("#user_roles-tab-custom tbody").prepend(n(r));var t=jQuery('[data-grant-cap="'+e+'"]').parents(".user_roles-cap-checklist");jQuery(t).addClass("user_roles-highlight"),setTimeout(function(){jQuery(t).removeClass("user_roles-highlight")},500),jQuery("#user_roles-new-cap-field").val(""),jQuery("#user_roles-add-new-cap").prop("disabled",!0),jQuery('.user_roles-cap-checklist input[data-grant-cap="'+e+'"]').trigger("change")}})});